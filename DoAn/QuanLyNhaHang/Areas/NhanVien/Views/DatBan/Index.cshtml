@using QuanLyNhaHang.Models
@model List<DatBan>
@{
    ViewBag.Title = "Danh Sách Đặt Bàn";
    Layout = "~/Areas/NhanVien/Views/Shared/_LayoutNhanVien.cshtml";
}

<div class="container" id="DanhSachDatBan">
    <div class="page-title-container">
        <div class="row g-0">
            <div class="col-auto mb-3 mb-md-0 me-auto">
                <div class="w-auto">
                    <h1 class="mb-0 pb-0 " id="title">Danh Sách Đặt Bàn</h1>
                </div>
            </div>
        </div>
    </div>
    <div class="row mb-2">
        <div class="col-sm-12 col-md-5 col-lg-3 col-xxl-2 mb-1">
            <div class="d-inline-block float-md-start me-1 mb-1 search-input-container w-100 shadow bg-foreground">
                <input class="form-control search" placeholder="Search">
                <span class="search-magnifier-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="cs-icon cs-icon-search"><circle cx="9" cy="9" r="7"></circle><path d="M14 14L17.5 17.5"></path></svg>
                </span>
                <span class="search-delete-icon d-none">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="cs-icon cs-icon-close"><path d="M5 5 15 15M15 5 5 15"></path></svg>
                </span>
            </div>
        </div>
    </div>
    <div class="col-sm-5 col-md-4 col-lg-3 col-xxl-10 mb-1">
        <div class="d-flex gap-3 align-items-center">
            <label><input type="checkbox" class="filter-date" value="today" /> Hôm nay</label>
            <label><input type="checkbox" class="filter-date" value="tomorrow" /> Ngày mai</label>
            <label><input type="checkbox" class="filter-date" value="nextweek" /> Tuần tới</label>
        </div>
    </div>
    <br />
    <div class="row g-0">
        <div class="col-12 mb-5">
            <div id="checkboxTable">
                <div class="mb-4 mb-lg-3 bg-transparent no-shadow d-none d-lg-block">
                    <div class="row g-0">
                        <div class="col">
                            <div class="ps-5 pe-4 h-100">
                                <div class="row g-0 h-100 align-content-center custom-sort">
                                    <div class="col-lg-1 d-flex flex-column pe-1 justify-content-center">
                                        <div class="text-muted text-body cursor-pointer sort" data-sort="TenKhachHang">Mã Đặt Bàn</div>
                                    </div>
                                    <div class="col-lg-2 d-flex flex-column pe-1 justify-content-center">
                                        <div class="text-muted text-body cursor-pointer sort" onclick="HiddenPass()" id="MatKhau" data-sort="NgayTao">Bắt Đầu (Dự Kiến)</div>
                                    </div>
                                    <div class="col-lg-1 d-flex flex-column pe-1 justify-content-left">
                                        <div class="text-muted text-body cursor-pointer sort" data-sort="NgayThanhToan">Số Người</div>
                                    </div>
                                    <div class="col-lg-2 d-flex flex-column pe-1 justify-content-center">
                                        <div class="text-muted text-body cursor-pointer sort" data-sort="TongTien">Tổng Tiền (Tạm Tính)</div>
                                    </div>
                                    <div class="col-lg-1 d-flex flex-column pe-1 justify-content-center">
                                        <div class="text-muted text-body cursor-pointer sort" data-sort="ThanhToan">Số Tiền Cọc</div>
                                    </div>
                                    <div class="col-lg-1 d-flex flex-column pe-1 justify-content-center">
                                        <div class="text-muted text-body cursor-pointer sort" data-sort="ThanhToan">Trạng Thái</div>
                                    </div>
                                    <div class="col-lg-2 d-flex flex-column pe-1 justify-content-center">
                                        <div class="text-muted text-body cursor-pointer sort" data-sort="TongTien">Thao Tác</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- #region Danh sách hóa đơn -->
                <div class="list">
                    @foreach (var item in Model)
                    {
                        <div class="card mb-2">
                            <div class="row g-0 h-100 sh-lg-9 position-relative">
                                <div class="col py-4 py-lg-0">
                                    <div class="ps-5 pe-4 h-100">
                                        <div class="row g-0 h-100 align-content-center">
                                            <a href="Products.Detail.html" class="col-12 col-lg-1 d-flex flex-column mb-lg-0 mb-3 pe-3 d-flex order-1 h-lg-100 justify-content-center MaDatBan">
                                                @item.MaDatBan
                                            </a>
                                            <div class="col-12 col-lg-2 d-flex flex-column pe-1 mb-2 mb-lg-0 justify-content-center order-3">
                                                <div class="lh-1 text-alternate ThoiGianBatDau">@string.Format("{0:dd/MM/yyyy HH:mm:ss}", item.ThoiGianBatDau)</div>
                                            </div>
                                            <div class="col-12 col-lg-1 d-flex flex-column pe-1 mb-2 mb-lg-0 justify-content-center order-3">
                                                <in class="lh-1 text-alternate SoNguoi">@item.SoNguoi</in>
                                            </div>
                                            <div class="col-12 col-lg-2 d-flex flex-column pe-1 mb-2 mb-lg-0 justify-content-center order-3">
                                                <div class="lh-1 text-alternate TongTienTamTinh">@string.Format("{0:0,0}", item.TongTienTamTinh) vnđ</div>
                                            </div>
                                            <div class="col-12 col-lg-1 d-flex flex-column pe-1 mb-2 mb-lg-0 justify-content-center order-3">
                                                <div class="lh-1 text-alternate SoTienCoc">@string.Format("{0:0,0}", item.SoTienCoc) vnđ</div>
                                            </div>
                                            <div class="col-12 col-lg-1 d-flex flex-column pe-1 mb-2 mb-lg-0 justify-content-center order-3">
                                                @switch (item.TrangThai)
                                                {
                                                    case 0:
                                                        <div class="lh-1 text-alternate TrangThai">Chờ Xác Nhận</div>
                                                        break;
                                                    case 1:
                                                        <div class="lh-1 text-alternate TrangThai">Đã cọc tiền</div>
                                                        break;
                                                    case 2:
                                                        <div class="lh-1 text-alternate TrangThai">Đã Hủy</div>
                                                        break;
                                                    default:
                                                        <div class="lh-1 text-alternate TrangThai">Không Xác Định</div>
                                                        break;
                                                }
                                            </div>
                                            <div class="col-12 col-lg-2 d-flex flex-column pe-1 mb-2 mb-lg-0 justify-content-center order-3">
                                                <div class="lh-1 text-alternate">
                                                    <div>
                                                        @if (item.TrangThai != 2)
                                                        {
                                                            <a href="/NhanVien/DatBan/XacNhanDatCoc?iMaDatBan=@item.MaDatBan"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="cs-icon cs-icon-check-square text-primary me-2" data-bs-toggle="tooltip" data-bs-placement="bottom" title="" data-bs-original-title="Xác nhận đã cọc tiền" aria-label="Trusted"><path d="M17 5L10.6329 12.2032C10.2511 12.6351 9.58418 12.6556 9.17656 12.248L6.92857 10"></path><path d="M11 2L5.5 2C4.09554 2 3.39331 2 2.88886 2.33706C2.67048 2.48298 2.48298 2.67048 2.33706 2.88886C2 3.39331 2 4.09554 2 5.5L2 14.5C2 15.9045 2 16.6067 2.33706 17.1111C2.48298 17.3295 2.67048 17.517 2.88886 17.6629C3.39331 18 4.09554 18 5.5 18L14.5 18C15.9045 18 16.6067 18 17.1111 17.6629C17.3295 17.517 17.517 17.3295 17.6629 17.1111C18 16.6067 18 15.9045 18 14.5L18 11"></path></svg></a>
                                                            <a href="/NhanVien/DatBan/HuyDatBan?iMaDatBan=@item.MaDatBan"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="cs-icon cs-icon-bin" data-bs-placement="bottom" style="color:red" data-bs-original-title="Xóa" aria-label="Xóa" title=""><path d="M4 5V14.5C4 15.9045 4 16.6067 4.33706 17.1111C4.48298 17.3295 4.67048 17.517 4.88886 17.6629C5.39331 18 6.09554 18 7.5 18H12.5C13.9045 18 14.6067 18 15.1111 17.6629C15.3295 17.517 15.517 17.3295 15.6629 17.1111C16 16.6067 16 15.9045 16 14.5V5"></path><path d="M14 5L13.9424 4.74074C13.6934 3.62043 13.569 3.06028 13.225 2.67266C13.0751 2.50368 12.8977 2.36133 12.7002 2.25164C12.2472 2 11.6734 2 10.5257 2L9.47427 2C8.32663 2 7.75281 2 7.29981 2.25164C7.10234 2.36133 6.92488 2.50368 6.77496 2.67266C6.43105 3.06028 6.30657 3.62044 6.05761 4.74074L6 5"></path><path d="M2 5H18M12 9V13M8 9V13"></path></svg></a>
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <!-- #endregion -->
                <div class="w-100 d-flex justify-content-center">
                    <ul class="pagination"></ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- #region Script lọc -->
<script type="text/javascript">
    var options = {
        valueNames: ['MaDatBan', 'ThoiGianBatDau', 'SoNguoi', 'TongTienTamTinh', 'SoTienCoc', 'TrangThai'],
        page: 8,
        pagination: true
    };
    var userList = new List('DanhSachDatBan', options);

    // Parse ngày dạng "dd/MM/yyyy HH:mm:ss"
    function parseVNDateTime(dateString) {
        const parts = dateString.trim().split(" ");
        const dateParts = parts[0].split("/");
        const timeParts = parts[1].split(":");
        return new Date(
            parseInt(dateParts[2]), // year
            parseInt(dateParts[1]) - 1, // month
            parseInt(dateParts[0]), // day
            parseInt(timeParts[0]), // hour
            parseInt(timeParts[1]), // minute
            parseInt(timeParts[2]) // second
        );
    }

    function isInFilterRange(date, filters) {
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1);

        const endOfNextWeek = new Date(today);
        endOfNextWeek.setDate(today.getDate() + 7);

        return (
            (filters.includes("today") && date.toDateString() === today.toDateString()) ||
            (filters.includes("tomorrow") && date.toDateString() === tomorrow.toDateString()) ||
            (filters.includes("nextweek") && date > tomorrow && date <= endOfNextWeek)
        );
    }

    function applyDateFilter() {
        const activeFilters = [];
        document.querySelectorAll('.filter-date:checked').forEach(cb => {
            activeFilters.push(cb.value);
        });

        userList.filter(function (item) {
            if (activeFilters.length === 0) return true;

            const dateStr = item.values().ThoiGianBatDau;
            const date = parseVNDateTime(dateStr);
            return isInFilterRange(date, activeFilters);
        });
    }

    document.querySelectorAll('.filter-date').forEach(cb => {
        cb.addEventListener('change', applyDateFilter);
    });
</script>
<!-- #endregion -->
